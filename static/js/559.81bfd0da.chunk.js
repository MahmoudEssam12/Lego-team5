"use strict";(self.webpackChunklego=self.webpackChunklego||[]).push([[559],{54559:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var r=n(72791);function a(e,t,n,r,a,o,i){try{var c=e[o](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,a)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function c(e){a(i,r,o,c,u,"next",e)}function u(e){a(i,r,o,c,u,"throw",e)}c(void 0)}))}}var i=n(29439),c=n(87757),u=n.n(c),s=n(65764),l=n(1413),d="https://lego-team5.herokuapp.com";function p(e,t){return h.apply(this,arguments)}function h(){return(h=o(u().mark((function e(t,n){var r,a,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,l.Z)({method:"POST",body:null},n),a=r.method,o=r.body,e.next=3,fetch("".concat(d,"/").concat(t),(0,l.Z)((0,l.Z)({method:a},o&&{body:JSON.stringify(o)}),{},{headers:{"Content-Type":"application/json"}}));case 3:return i=e.sent,e.abrupt("return",i.json());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=n(16030),f=n(30456),v=n(55646),x=n(94070),y=n(80184);function b(){var e=(0,r.useState)((function(){return(0,f.Z)(localStorage.getItem("token")).email})),t=(0,i.Z)(e,1)[0],n=(0,m.v9)((function(e){return e.cart})),a=Object.values(n.products),c=(0,r.useState)(!1),l=(0,i.Z)(c,2),d=(l[0],l[1],(0,r.useState)(!1)),h=(0,i.Z)(d,2),b=h[0],k=h[1],j=(0,r.useState)(""),w=(0,i.Z)(j,2),g=w[0],S=w[1],Z=a.map((function(e){return{quantity:e.quantity,title:e.name,images:e.images.map((function(e){return"http://localhost:8080/images/".concat(e)})),price:e.price}})),C=function(e,t){"clickaway"!==t&&k(!1)},P=(0,s.useStripe)(),N=function(){var e=o(u().mark((function e(r){var a,o,i,c,s,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),!(null===(a=(0,f.Z)(localStorage.getItem("token")))||void 0===a||null===(o=a.user)||void 0===o?void 0:o.blocked)){e.next=7;break}k(!0),S("you have breached our rules you are blocked"),e.next=18;break;case 7:return i=Z.map((function(e){return{quantity:e.quantity,price_data:{currency:"egp",unit_amount:100*e.price,product_data:{name:e.title,description:e.description,images:e.images}}}})),e.next=10,p("create-checkout-session",{body:{line_items:i,customer_email:t,totalPrice:n.totalPrice}});case 10:return c=e.sent,s=c.sessionId,e.next=14,P.redirectToCheckout({sessionId:s});case 14:if(l=e.sent,!l.error){e.next=18;break}return e.abrupt("return");case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,y.jsxs)("form",{onSubmit:N,children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("input",{disabled:!0,type:"email",placeholder:"Email",value:t,className:"stripe-email-input"}),!/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(.\w{2,3})+$/.test(t)&&""!==t&&(0,y.jsx)("p",{className:"error",children:"Enter a Valid Email Address"})]}),(0,y.jsx)("div",{className:"submit-button",children:(0,y.jsx)("button",{type:"submit",className:"checkout-button",children:"Checkout"})}),(0,y.jsx)(v.Z,{open:b,autoHideDuration:3e3,onClose:C,severity:"error",children:(0,y.jsx)(x.Z,{onClose:C,severity:"error",sx:{width:"100%"},children:g})})]})}function k(){var e=(0,m.v9)((function(e){return e.cart.totalItemsCount})),t=(0,m.v9)((function(e){return e.cart.totalPrice}));return(0,y.jsxs)("div",{className:"checkout",children:[(0,y.jsx)("h2",{children:"Checkout Summary"}),(0,y.jsx)("h3",{children:"Total Items: ".concat(e)}),(0,y.jsx)("h4",{children:"Amount to Pay: ".concat(t>1e3?t.toFixed(2):Number(t.toFixed(2))+30," EGP")}),(0,y.jsx)(b,{})]})}}}]);
//# sourceMappingURL=559.81bfd0da.chunk.js.map